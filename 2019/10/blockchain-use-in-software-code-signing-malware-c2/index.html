<!doctype html>
<html class="no-js" data-theme="dark" lang="en-us">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Karl&#39;s Blog</title>
        <meta name="author" content="Karl Sickendick">
        <meta name="description" content="Karl&#39;s blog of randomness and programming">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta property="og:title" content="Blockchain Use in Software Code Signing &amp; Malware C2" />
<meta property="og:description" content="I’ve done some small research about blockchain recently, and just want to put my thoughts down on paperblog so I can stop thinking them. Most of this is rehashing information I’ve read, but the “signed code verification” piece towards the end is an idea of mine that I’ve not read about elsewhere.
 Blockchain is a hot term these days. It&rsquo;s a popular management buzzword, and as such it can get thrown about as a cure for just about all that ails you." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.notmet.net/2019/10/blockchain-use-in-software-code-signing-malware-c2/" />
<meta property="article:published_time" content="2019-10-31T16:09:57+00:00" />
<meta property="article:modified_time" content="2019-10-31T16:09:57+00:00" />

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Blockchain Use in Software Code Signing &amp; Malware C2"/>
<meta name="twitter:description" content="I’ve done some small research about blockchain recently, and just want to put my thoughts down on paperblog so I can stop thinking them. Most of this is rehashing information I’ve read, but the “signed code verification” piece towards the end is an idea of mine that I’ve not read about elsewhere.
 Blockchain is a hot term these days. It&rsquo;s a popular management buzzword, and as such it can get thrown about as a cure for just about all that ails you."/>
<meta name="twitter:site" content="@kc0bfv"/>

        <meta name="generator" content="Hugo 0.64.0" />
        
        <link href='//fonts.googleapis.com/css?family=Roboto:400,300,700%7CNoto+Serif:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://blog.notmet.net/css/styles.css">
        <link rel="icon" href="https://blog.notmet.net/favicon.ico">
        <link rel="stylesheet" href="https://blog.notmet.net/css/highlightjs/monokai.css">
        <script src="https://blog.notmet.net/js/vendor/modernizr-2.8.0.min.js"></script>
        

        <script>
            
            function randomHeaderImg() {
                let images = ["https://blog.notmet.net/wp-content/uploads/2017/12/IMG_20171012_150021.jpg","https://blog.notmet.net/wp-content/uploads/2017/12/IMG_20171008_114417.jpg","https://blog.notmet.net/wp-content/uploads/2017/12/20161104_125204.jpg","https://blog.notmet.net/wp-content/uploads/2012/07/blog.jpg","https://blog.notmet.net/wp-content/uploads/2012/07/cropped-arequipadoorheader.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/austinWindows.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/bridge.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/candles.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/coloredWindows.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/coolStepsBro.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/cuzcoNight.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/flowerClose.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/guinneaPigMeal.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/ivyWall.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/montereyTree.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/motorcycle.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/mushroom.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/cropped-peruFruit.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/piccu.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/piccuEdge.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/seaweed.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/smallFalls.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/terraceFarming.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/treeHouse.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/treeShadow.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/waterBridge.jpg"];
                let img_ind = Math.ceil(Math.random() * images.length) - 1;
                let sel_url = images[img_ind];
                let img = new Image();
                img.onload = function() {
                    function set_img() {
                        let element = document.getElementsByClassName("site-header")[0];
                        element.style.backgroundImage = "url(" + sel_url + ")";
                    }
                    if( document.readyState === "complete" ) { set_img() }
                    else { window.onload = set_img }
                }
                img.src = sel_url;
            }
            randomHeaderImg();
            
        </script>
        
        <noscript>
            <style>
                .site-header {
                    background-image: url(https://blog.notmet.net/wp-content/uploads/2017/12/IMG_20171012_150021.jpg);
                }
            </style>
        </noscript>
        
    </head>
    <body>
        <header class="site-header">
          <div>
          
          </div>
        </header>
        <div class="container clearfix">
            <nav class="nav" id="navtop">
  <p class="link"><a href="https://notmet.net/">Homepage</a></p>
<p class="link"><a href="/categories/">Categories</a></p>
<p class="link"><a href="/tags/">Tags</a></p>
<p class="link"><a href="/archive/">Archive</a></p>

</nav>


            <main class="content">

    <article class="post">
        <a class="btn home" href="https://blog.notmet.net/" title="Back to home">&laquo; Back to home</a>
        
<h1><a href="https://blog.notmet.net/2019/10/blockchain-use-in-software-code-signing-malware-c2/">Blockchain Use in Software Code Signing &amp; Malware C2</a></h1>

<footer class="post-info">Posted on <span class="post-meta"><time datetime="2019-10-31">2019.10.31</time>

</span>
</footer>

        <blockquote>
<p>I’ve done some small research about blockchain recently, and just want to put my thoughts down on paperblog so I can stop thinking them.  Most of this is rehashing information I’ve read, but the “signed code verification” piece towards the end is an idea of mine that I’ve not read about elsewhere.</p>
</blockquote>
<p>Blockchain is a hot term these days.  It&rsquo;s a popular management buzzword, and as such it can get thrown about as a cure for just about all that ails you.  All businesses need to store data, and blockchain is known as a data-store, so everyone wants to make sure you&rsquo;ve considered their (probably expensive) blockchain solution for data storage…</p>
<p>Blockchain is good at solving a couple problems though.</p>
<ul>
<li>It can provide a publicly-verifiable record of data&rsquo;s existence at a point in time.  At any point in the future, anybody with access to the blockchain can prove that a certain piece of data existed at the point it was stored on the blockchain.  If you&rsquo;ve got a document that has been digitally signed, you can store the hash of that document on the blockchain.  Later blockchain links will all chain back to your document hash, and their presence will prove that your document predated their transactions.  Because blockchain additions (is most implementations) occur on fixed schedules, it will be possible to reconstruct exactly when your document must have been added to the chain.</li>
<li>Publicly-verifiable records of data&rsquo;s existence can prove transactions have occurred, or contracts have been signed.  This is how a blockchain can act as a ledger.  Transactions on the blockchain can represent physical-world transactions, if the participants assign them that meaning, enabling tracking of the transfer of real-world entities between blockchain participants.  On a public blockchain these transfers are transparent to everyone involved at all points in the future.  They cannot be reverted by any individual except by a future transaction.</li>
<li>Transparency means that no trusted third-party needs to exist.  Transactions can occur more easily between non-trusting parties without an escrow.</li>
<li>Public blockchains get stored by many parties, each having an economic incentive to participate.  That means any data stored on them is stored in many places, providing data replication and the potential for access from disparate parts of the world.  To store a small amount of data, little economic incentive is required.  To store larger amounts of data, much greater incentive is required.</li>
</ul>
<p>These solutions are enabled by some prerequisites.</p>
<ul>
<li>Blockchains require lots of computational power.  Specifically, they require more than your adversaries.  To prove data&rsquo;s existence at a point in time, links must be added to the chain periodically.  When adding links to the chain, the other participants in the blockchain must agree on their addition.  If there are malicious participants in the blockchain, they may decide to disagree about a set of new links, and instead agree on a different set of links.  If the malicious participants form a majority, other participants in the chain will be influenced to believe the new malicious links are legitimate and ignore the others.  Participants make decisions based upon cryptographic data that&rsquo;s passed around, and computing that cryptographic data requires computational power.  Therefore, to prevent a malicious takeover of a blockchain, you must have more computational power than any malicious adversaries can muster.  In a public blockchain, you get the benefit of all the disparate participants&rsquo; computational power.  Your adversaries must then overpower the public, instead of just you.</li>
<li>Blockchains require a computer network connecting participants.  When designing a blockchain for use in low-Internet access areas you really restrict your ability to use existing public blockchains.  To add data to a blockchain you must submit your transaction to the other participants, and enough of them must get it for your data to have any chance of being added.  If you stop using public blockchains, or use small ones, perhaps because you&rsquo;re in a remote area, you open yourself up to attacks based on computational power.</li>
<li>Public blockchains require economic incentive.  Computational power costs money - for hardware, network access, and electricity.  Participants in a blockchain require computational power.  Thus, participants need a monetary incentive to participate.  You pay for data additions to Bitcoin&rsquo;s blockchain by supplying a small amount of bitcoin that is automatically paid to the individual who adds your data to the blockchain.  The amount of data added by each transaction is small, so larger chunks of data require multiple transactions and more bitcoin.</li>
</ul>
<p>Lots of proposed uses for blockchain have limited applicability due to these requirements.</p>
<h2 id="potential-use-case-malware-command-and-control-c2">Potential Use Case: Malware Command and Control (C2)</h2>
<p>Malware C2 is an interesting use for blockchain, though.  Malware running on end-points often needs to reach out to its creators for further instruction.  “Steal files”, “learn about the local network”, “propagate to a nearby computer”, “record keystrokes”, or “delete yourself” are all things malware might want to do, but only when commanded by a remote attacker.  Often malware reaches out to one destination for these commands.  This is the simplest C2 implementation, where one or a few hard-coded server name or IP address provide the C2 to the malware.</p>
<p>Network defenders can try to detect and block this behavior by redirecting those C2 servers to alternate locations, pretending to be those C2 servers, or by taking over the C2 servers with the permission of law enforcement or the server’s rightful owner.</p>
<p>Blockchain’s distributed nature makes this much more difficult.  Given a good-enough implementation, it could be difficult or impossible for defenders to block access to a copy of the blockchain.  Because there’s no central server it’s not possible for a defender to take over the blockchain, either.  Once a C2 command is added to the blockchain, it is impractical to remove it, too.</p>
<p><a href="https://www.forbes.com/sites/billybambrough/2019/09/07/serious-malware-warning-over-bitcoin-blockchain/#4d5e2bed7c28">We’ve seen a few uses of it this method already</a>.  <a href="https://www.theregister.co.uk/2018/06/20/blockchain_bitcoin/">Omer Zohar built and demonstrated this use-case in early 2018</a>.  He used Ethereum and its “smart contracts” system to implement encrypted C2 of a nearly unlimited number of malware endpoints.  <a href="https://github.com/platdrag/UnblockableChains">The result was a system that is extremely difficult to block or subvert</a>.  As Ethereum increases in popularity the system will be increasingly hard to block.  His major limitation was operational cost.  Each message to and from an endpoint cost a small amount of Ether, translating to (at the time) about $39 per year per malware instance.</p>
<p>Anonymity is a major benefit of such a system.  Many consider blockchain participation to be completely anonymous, however participation often requires money, and that money must enter the system from some point.  That money typically comes from a traceable source, however malware authors also steal or “mine” cryptocurrency.  Such activity would provide a less-traceable source, and make the system nearly entirely anonymous.</p>
<h2 id="potential-use-case-code-signing-transparency">Potential Use Case: Code Signing Transparency</h2>
<p>Another potential use for blockchain is in software signature verification.  Microsoft’s Windows and Apple’s OS X use software signatures to verify that software was produced by an entity (a company or individual).  Software producers compile their code into binaries, then digitally sign them before sending those binaries out into the wild.</p>
<p>This provides end users the assurance that a specific company made the binary.  An example is if someone emails you a version of Microsoft’s Notepad.  Before executing it you would want to make sure it was actually from Microsoft, otherwise a malicious actor could have modified Notepad to include malicious software.  If Microsoft has signed this copy of Notepad, you can verify that signature and prove that Microsoft created it.  You would know then that the version of Notepad was safe to execute.  Windows and OS X now make it more difficult to execute software that’s not digitally signed by some vendor.</p>
<p>Stuxnet is a piece of malware that abused software signatures.  It included components that were signed by legitimate, trusted software vendors.  This made those components more likely to be trusted and less likely to be detected.  <a href="https://arstechnica.com/information-technology/2017/11/evasive-code-signed-malware-flourished-before-stuxnet-and-still-does/">Other malware has abused software signatures, but none has been as high-profile as Stuxnet</a>.</p>
<p>Blockchain’s distributed, transparent, nearly-immutable nature can help solve this problem.</p>
<p>Software signatures can currently be verified by a client who trusts a root certificate, and can the follow that root certificate trust through a set of other certificates to the software signature in question.  One certificate signs the next, which signs the next…  Good verification requires checking a revocation list too, so when invalid signatures are found in-the-wild they can be cancelled.</p>
<p>If an additional step for verification required signatures to be found in a public database of software signatures, all malicious code signers would have to publish their signatures to this public database too.  Companies could check the database to determine if someone is signing code on their behalf.</p>
<p>In the event of Stuxnet, JMicron Technology and Realtek Semiconductor would have been able to check the public database regularly.  They would have seen a software signature they did not issue, and they could have placed it on the revocation list immediately.  They could have then taken action to prevent further signatures in their name.</p>
<p>A blockchain can act as this public database.  The result would be widely distributed, and it would be practically impossible to modify or remove signature entries after they were added.  As an added benefit, it would become more obvious to observers when a company holds compromised certificates that should no-longer be trusted, and that company’s security practices could become (rightly) suspect.  Because blockchain provides an irrefutable timestamp when data is added, signature attack timelines will also become more transparent to security researchers.</p>
<p>Every valid software signature would incur a small cost to be added to the blockchain.  Additionally, the signature verification process would become more complex and require Internet access.  However, software and hardware vendors could implement API endpoints that handle the blockchain portion of verification, simplifying lookup code for the endpoints they sell.  The result would still provide transparency for all signature creators and verifiers.</p>
<p>I haven’t seen this solution proposed elsewhere, however <a href="http://users.umiacs.umd.edu/~tdumitra/papers/CCS-2017.pdf">Kim, Kwon and Dumitras recommend that code signing tools log all transactions they complete [Kim, 2017]</a>.  Tools like “signtool.exe” in Windows would log “the hash value of program code and the certificates” to Microsoft, then third parties could “periodically audit the log and identify code signing abuse”.  This is great, however it doesn’t require software to verify that signatures are present in that log during signature verification.  Without that, any attacker that subverts the signature reporting process, by preventing reporting to Microsoft, gets their software signed without reporting it.</p>
<h2 id="references">References:</h2>
<p>Some discussion of blockchain benefits and requirements: <a href="https://blog.todotnet.com/2019/03/solving-real-world-problems-with-distributed-ledger-technology/">https://blog.todotnet.com/2019/03/solving-real-world-problems-with-distributed-ledger-technology/</a></p>
<p>Paper about blockchain potential in the military: <a href="https://www.jcs.mil/Portals/36/Documents/Doctrine/Education/jpme_papers/barnas_n.pdf?ver=2017-12-29-142140-393">https://www.jcs.mil/Portals/36/Documents/Doctrine/Education/jpme_papers/barnas_n.pdf?ver=2017-12-29-142140-393</a></p>
<p>Doowon Kim, Bum Jun Kwon, and Tudor Dumitraş. 2017. Certified Malware: Measuring Breaches of Trust in the Windows Code-Signing PKI. In Proceedings of the 2017 ACM SIGSAC Conference on Computer and Communications Security (CCS &lsquo;17). ACM, New York, NY, USA, 1435-1448. DOI: <a href="https://doi.org/10.1145/3133956.3133958">https://doi.org/10.1145/3133956.3133958</a>.  URL: <a href="http://users.umiacs.umd.edu/~tdumitra/papers/CCS-2017.pdf">http://users.umiacs.umd.edu/~tdumitra/papers/CCS-2017.pdf</a></p>

        <ul class="share-buttons">
    <li>Share this article:</li>
    <li>
        <a class="icon-facebook-squared" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.notmet.net%2f2019%2f10%2fblockchain-use-in-software-code-signing-malware-c2%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook"></a>
    </li>
    <li>
        <a class="icon-twitter" href="https://twitter.com/share?text=Blockchain%20Use%20in%20Software%20Code%20Signing%20%26%20Malware%20C2&amp;url=https%3a%2f%2fblog.notmet.net%2f2019%2f10%2fblockchain-use-in-software-code-signing-malware-c2%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Tweet this article"></a>
    </li>
    <li>
        <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.notmet.net%2f2019%2f10%2fblockchain-use-in-software-code-signing-malware-c2%2f&title=Blockchain%20Use%20in%20Software%20Code%20Signing%20%26%20Malware%20C2" onclick="window.open(this.href, 'linkedin-share', 'width=600,height=494');return false;" title="Share on Linkedin"></a>
    </li>
</ul>

    </article>
    
</main>
<aside class="author">
  <img class="profile-image" src="https://s.gravatar.com/avatar/8dcaef6cede11442234ac079a71f35a8?s=80" alt="Karl Sickendick" />
  <p class="name">by 
  <strong>Karl Sickendick</strong></p>
  <p class="address"></p>
  <p class="link"></p>
  <ul class="social">
    
<li><a href="//twitter.com/kc0bfv" class="icon-twitter" target="_blank" title="Twitter" aria-label="Twitter"></a></li>













<li><a href="//github.com/kc0bfv" class="icon-github" target="_blank" title="Github" aria-label="Github"></a></li>


<li><a href="https://blog.notmet.net/index.xml" class="icon-rss" target="_blank" title="RSS" aria-label="RSS"></a></li>

  </ul>
  <br><br>
</aside>

<nav class="nav" id="navbot">
  <p class="link"><a href="https://notmet.net/">Homepage</a></p>
<p class="link"><a href="/categories/">Categories</a></p>
<p class="link"><a href="/tags/">Tags</a></p>
<p class="link"><a href="/archive/">Archive</a></p>

</nav>

</div>
<footer class="main-footer">
  <div class="container clearfix">
        <a class="icon-rss" href="https://blog.notmet.net/index.xml" title="RSS" aria-label="RSS"></a>
        <p>&copy; 2020 &middot; Karl Sickendick</p>
  </div>
</footer>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>window.jQuery || document.write('<script src="https:\/\/blog.notmet.net\/js\/vendor\/jquery-1.11.0.min.js"><\/script>')</script>
<script src="https://blog.notmet.net/js/plugins.js"></script>





<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-42117518-3', 'auto');
	
	ga('send', 'pageview');
}
</script>

</body>
</html>

