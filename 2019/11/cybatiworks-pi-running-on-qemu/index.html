<!doctype html>
<html class="no-js" data-theme="dark" lang="en-us">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>CybatiWorks PI - Running on QEMU &middot; Karl&#39;s Blog</title>
        <meta name="author" content="Karl Sickendick">
        <meta name="description" content="Karl&#39;s blog of randomness and programming">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta property="og:title" content="CybatiWorks PI - Running on QEMU" />
<meta property="og:description" content="CybatiWorks is an educational and research tool for learning about Industrial Control System cyber components. I haven&rsquo;t used it much, but it looks like it&rsquo;ll simulate a PLC controlling a process, and it&rsquo;ll do it on a Raspberry PI, GPIO-connected hardware, and a controlling HMI (Human-Machine Interface) desktop. You can buy the hardware pre-setup, then use it in a course.
The person who runs the company is Matthew Luallen, and he&rsquo;s quite responsive over email." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.notmet.net/2019/11/cybatiworks-pi-running-on-qemu/" />
<meta property="article:published_time" content="2019-11-01T20:20:33+00:00" />
<meta property="article:modified_time" content="2019-11-01T20:20:33+00:00" />

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="CybatiWorks PI - Running on QEMU"/>
<meta name="twitter:description" content="CybatiWorks is an educational and research tool for learning about Industrial Control System cyber components. I haven&rsquo;t used it much, but it looks like it&rsquo;ll simulate a PLC controlling a process, and it&rsquo;ll do it on a Raspberry PI, GPIO-connected hardware, and a controlling HMI (Human-Machine Interface) desktop. You can buy the hardware pre-setup, then use it in a course.
The person who runs the company is Matthew Luallen, and he&rsquo;s quite responsive over email."/>
<meta name="twitter:site" content="@kc0bfv"/>

        <meta name="generator" content="Hugo 0.70.0" />
        
        <link href='//fonts.googleapis.com/css?family=Roboto:400,300,700%7CNoto+Serif:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://blog.notmet.net/css/styles.css">
        <link rel="icon" href="https://blog.notmet.net/favicon.ico">
        <link rel="stylesheet" href="https://blog.notmet.net/css/highlightjs/monokai.css">
        <script src="https://blog.notmet.net/js/vendor/modernizr-2.8.0.min.js"></script>
        

        <script>
            
            function randomHeaderImg() {
                let images = ["https://blog.notmet.net/wp-content/uploads/2017/12/IMG_20171012_150021.jpg","https://blog.notmet.net/wp-content/uploads/2017/12/IMG_20171008_114417.jpg","https://blog.notmet.net/wp-content/uploads/2017/12/20161104_125204.jpg","https://blog.notmet.net/wp-content/uploads/2012/07/blog.jpg","https://blog.notmet.net/wp-content/uploads/2012/07/cropped-arequipadoorheader.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/austinWindows.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/bridge.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/candles.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/coloredWindows.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/coolStepsBro.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/cuzcoNight.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/flowerClose.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/guinneaPigMeal.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/ivyWall.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/montereyTree.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/motorcycle.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/mushroom.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/cropped-peruFruit.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/piccu.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/piccuEdge.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/seaweed.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/smallFalls.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/terraceFarming.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/treeHouse.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/treeShadow.jpg","https://blog.notmet.net/wp-content/uploads/2012/10/waterBridge.jpg"];
                let img_ind = Math.ceil(Math.random() * images.length) - 1;
                let sel_url = images[img_ind];
                let img = new Image();
                img.onload = function() {
                    function set_img() {
                        let element = document.getElementsByClassName("site-header")[0];
                        element.style.backgroundImage = "url(" + sel_url + ")";
                    }
                    if( document.readyState === "complete" ) { set_img() }
                    else { window.onload = set_img }
                }
                img.src = sel_url;
            }
            randomHeaderImg();
            
        </script>
        
        <noscript>
            <style>
                .site-header {
                    background-image: url(https://blog.notmet.net/wp-content/uploads/2017/12/IMG_20171012_150021.jpg);
                }
            </style>
        </noscript>
        
    </head>
    <body>
        <header class="site-header">
          <div>
          
          </div>
        </header>
        <div class="container clearfix">
            <nav class="nav" id="navtop">
  <p class="link"><a href="https://notmet.net/">Homepage</a></p>
<p class="link"><a href="/categories/">Categories</a></p>
<p class="link"><a href="/tags/">Tags</a></p>
<p class="link"><a href="/archive/">Archive</a></p>

</nav>


            <main class="content">

    <article class="post">
        <a class="btn home" href="https://blog.notmet.net/" title="Back to home">&laquo; Back to home</a>
        
<h1><a href="https://blog.notmet.net/2019/11/cybatiworks-pi-running-on-qemu/">CybatiWorks PI - Running on QEMU</a></h1>

<footer class="post-info">Posted on <span class="post-meta"><time datetime="2019-11-01">2019.11.01</time>

</span>
</footer>

        <p>CybatiWorks is an educational and research tool for learning about Industrial Control System cyber components.  I haven&rsquo;t used it much, but it looks like it&rsquo;ll simulate a PLC controlling a process, and it&rsquo;ll do it on a Raspberry PI, GPIO-connected hardware, and a controlling HMI (Human-Machine Interface) desktop.  You can buy the hardware pre-setup, then use it in a course.</p>
<p>The person who runs the company is Matthew Luallen, and he&rsquo;s quite responsive over email.  I&rsquo;ve been trying to look into the system a bit, and CybatiWorks offers the RasPI image for free through their &ldquo;Community&rdquo; program.  Unfortunately that&rsquo;s run by Google+, and is now a broken link.  Emailing the responsive founder, however, will get you a link to the necessary image.</p>
<p>Now that I had the RasPI image though, I needed to run it, and didn&rsquo;t have a PI handy.  It was time for QEMU.  <a href="http://scientia3s7potentia.blogspot.com/2016/01/cybatiworks-ics-pi-image-on-windows.html">This gentleman had a great start</a>, and following his instructions allowed me to investigate the system partially, but that methodology gets you only 256MB RAM total.  I needed more to start up all the services in the image, so I could see them work together.</p>
<p><a href="https://wiki.qemu.org/Documentation/Platforms/ARM">QEMU&rsquo;s documentation had a way forward</a> - use the &ldquo;virt&rdquo; machine instead of versatile.., but this necessitated building a new kernel.  Something I learned during this process - kernels built for one ARM machine don&rsquo;t seem to work well on others.  I&rsquo;m not 100% why, I&rsquo;ve definitely seen lots of binaries work interoperably, but kernels seem to be very specific (at least with QEMU).</p>
<p>The RasPI image comes with a kernel, f3n3s7ra&rsquo;s page recommended a kernel&hellip;  Unfortunately the QEMU documentation recommends installing a Debian image to get the <a href="https://notmet.net/downloads/debian_arm_kernel/vmlinuz-3.16.0-6-armmp-lpae">kernel</a> and <a href="https://notmet.net/downloads/debian_arm_kernel/initrd.img-3.16.0-6-armmp-lpae">initrd</a>.  That took several hours - now that I extracted them I&rsquo;ve got them available for download via the links in the previous sentence (these came from the Debian project on 1 Nov 2019).</p>
<p>Once you&rsquo;ve got initrd, vmlinuz, and CybatiWorksPI.img extracted from the email Matthew can send you, the command below will startup QEMU with a working network stack and kick you to a shell as root.  You may have to switch the window view over to &ldquo;serial0&rdquo;.</p>
<pre><code>sudo qemu-system-arm -M virt -m 1024 -kernel vmlinuz-3.16.0-6-armmp-lpae -initrd initrd.img-3.16.0-6-armmp-lpae -drive if=none,file=CybatiWorksPI.img,format=raw,id=hd -device virtio-blk-device,drive=hd -netdev tap,id=ethdev -device virtio-net-device,netdev=ethdev -no-reboot -append &quot;root=/dev/vda2 rootfstype=ext4 rw init=/bin/bash&quot;
</code></pre><p>You won&rsquo;t get the typical startup sequence via systemd, and I haven&rsquo;t been able to get that working yet, but you can do something similar with the command below (from the QEMU command line).  This&rsquo;ll kick off runlevel 3 startup scripts.</p>
<pre><code>cd /etc/rc3.d
for i in S*; do ./$i restart; done
</code></pre><p>Now an ifconfig should reveal that eth0 is up and at 172.16.192.30/24.  Back on your host computer &ldquo;sudo ip add add 172.16.192.10/24 dev tap0&rdquo; will configure tap0 to communicate with the QEMU box.  You should now be able to ping 172.16.192.30 from your host.</p>
<p>The default services now should be:<br>
TCP 22 - SSH<br>
TCP 80 - lighttpd<br>
TCP 2812 - <a href="https://mmonit.com/">monit</a><br>
TCP 7777 - RexWSTCP<br>
TCP 8000 - <a href="https://webiopi.trouch.com/">WebIOPi</a><br>
TCP 43981 - <a href="https://www.rexcontrols.com/">RexCore</a></p>
<p>If you want to run the HMI VM Matthew will send you, don&rsquo;t set your host to 172.16.192.30, so the VM can take that address.  After starting the VM up, you may have to configure subnets more intelligently, and IP forwarding on your host (so the different network devices in your host can communicate).</p>

        <ul class="share-buttons">
    <li>Share this article:</li>
    <li>
        <a class="icon-facebook-squared" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.notmet.net%2f2019%2f11%2fcybatiworks-pi-running-on-qemu%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook"></a>
    </li>
    <li>
        <a class="icon-twitter" href="https://twitter.com/share?text=CybatiWorks%20PI%20-%20Running%20on%20QEMU&amp;url=https%3a%2f%2fblog.notmet.net%2f2019%2f11%2fcybatiworks-pi-running-on-qemu%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Tweet this article"></a>
    </li>
    <li>
        <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.notmet.net%2f2019%2f11%2fcybatiworks-pi-running-on-qemu%2f&title=CybatiWorks%20PI%20-%20Running%20on%20QEMU" onclick="window.open(this.href, 'linkedin-share', 'width=600,height=494');return false;" title="Share on Linkedin"></a>
    </li>
</ul>

    </article>
    
</main>
<aside class="author">
  <img class="profile-image" src="https://s.gravatar.com/avatar/8dcaef6cede11442234ac079a71f35a8?s=80" alt="Karl Sickendick" />
  <p class="name">by 
  <strong>Karl Sickendick</strong></p>
  <p class="address"></p>
  <p class="link"></p>
  <ul class="social">
    
<li><a href="//twitter.com/kc0bfv" class="icon-twitter" target="_blank" title="Twitter" aria-label="Twitter"></a></li>













<li><a href="//github.com/kc0bfv" class="icon-github" target="_blank" title="Github" aria-label="Github"></a></li>



<li><a href="mailto:kc0bfv@notmet.net" class="icon-mail" title="Email" aria-label="Email"></a></li>


<li><a href="https://blog.notmet.net/index.xml" class="icon-rss" target="_blank" title="RSS" aria-label="RSS"></a></li>

  </ul>
  <br><br>
</aside>

<nav class="nav" id="navbot">
  <p class="link"><a href="https://notmet.net/">Homepage</a></p>
<p class="link"><a href="/categories/">Categories</a></p>
<p class="link"><a href="/tags/">Tags</a></p>
<p class="link"><a href="/archive/">Archive</a></p>

</nav>

</div>
<footer class="main-footer">
  <div class="container clearfix">
        <a class="icon-rss" href="https://blog.notmet.net/index.xml" title="RSS" aria-label="RSS"></a>
        <p>&copy; 2020 &middot; Karl Sickendick</p>
  </div>
</footer>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>window.jQuery || document.write('<script src="https:\/\/blog.notmet.net\/js\/vendor\/jquery-1.11.0.min.js"><\/script>')</script>
<script src="https://blog.notmet.net/js/plugins.js"></script>





<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-42117518-3', 'auto');
	
	ga('send', 'pageview');
}
</script>

</body>
</html>

